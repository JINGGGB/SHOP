<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>柠檬商店管理系统</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 柠檬汁滴装饰 -->
    <div class="lemon-drops">
        <div class="drop"></div>
        <div class="drop"></div>
        <div class="drop"></div>
        <div class="drop"></div>
    </div>
    
    <!-- 柠檬装饰元素 -->
    <div class="lemon-decoration"></div>
    
    <!-- 柠檬片装饰 -->
    <div class="lemon-slice"></div>
    <div class="lemon-slice"></div>
    
    <!-- 额外的柠檬装饰 - 性能优化版 -->
    <div style="position: absolute; top: 5%; left: 25%; font-size: 35px; opacity: 0.5; z-index: 1; animation: float-slow 20s ease-in-out infinite; pointer-events: none; will-change: transform; transform: translate3d(0, 0, 0);">🍋</div>
    <!-- 移除多余装饰以提升性能 -->


    <!-- 侧边栏覆盖层 -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- 侧边栏 -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="user-avatar">
                <span id="sidebar-avatar">👤</span>
            </div>
            <div class="user-info-sidebar">
                <h3 id="sidebar-username">用户</h3>
                <p id="sidebar-email"></p>
            </div>
            <button id="sidebar-close" class="sidebar-close">×</button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#" id="nav-shop" class="nav-item active">
                <span class="nav-icon">🛍️</span>
                <span class="nav-text">商店首页</span>
            </a>
            <a href="#" id="nav-products" class="nav-item manager-only" style="display: none;">
                <span class="nav-icon">📦</span>
                <span class="nav-text">商品管理</span>
            </a>
            <a href="#" id="nav-users" class="nav-item manager-only" style="display: none;">
                <span class="nav-icon">👥</span>
                <span class="nav-text">用户管理</span>
            </a>
            <a href="#" id="nav-profile" class="nav-item">
                <span class="nav-icon">👤</span>
                <span class="nav-text">个人设置</span>
            </a>
            <a href="#" id="nav-logout" class="nav-item logout" style="display: none;">
                <span class="nav-icon">🚪</span>
                <span class="nav-text">退出登录</span>
            </a>
        </nav>
    </div>

    <!-- 主要内容区域 -->
    <div id="main-content" class="main-content">
        
        <!-- 商店页面 -->
        <div id="shop-page" class="content-page" style="display: block;">
            <!-- 顶部导航栏 -->
            <div class="top-navbar">
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <div class="navbar-title">
                    <h1>🍋 柠檬商店</h1>
                </div>
                <div class="navbar-user">
                    <button id="notification-bell" class="notification-bell manager-only" style="display: none;" title="订单通知">
                        🔔
                        <span id="notification-badge" class="notification-badge" style="display: none;">0</span>
                    </button>
                    <span id="navbar-avatar">👤</span>
                </div>
            </div>
            
            <div class="page-header">
                <p>精选优质商品，品味生活美好</p>
            </div>
            
            <div class="categories-filter">
                <button class="filter-btn active" data-category="all">全部</button>
                <div id="category-buttons"></div>
            </div>
            
            <div class="products-grid" id="products-grid">
                <div class="loading">加载中...</div>
            </div>
        </div>

        <!-- 商品管理页面 -->
        <div id="products-page" class="content-page" style="display: none;">
            <!-- 顶部导航栏 -->
            <div class="top-navbar">
                <button id="products-sidebar-toggle" class="sidebar-toggle" onclick="app.toggleSidebar()">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <div class="navbar-title">
                    <h1>📦 商品管理</h1>
                </div>
                <div class="navbar-user">
                    <button id="notification-bell-products" class="notification-bell manager-only" style="display: none;" title="订单通知">
                        🔔
                        <span class="notification-badge" style="display: none;">0</span>
                    </button>
                    <button class="back-to-shop-btn" onclick="app.showContentPage('shop')" title="返回商店">
                        🏪
                    </button>
                    <span onclick="app.toggleSidebar()">👤</span>
                </div>
            </div>
            
            <div class="page-header">
                <button id="add-product-btn" class="btn-primary">新增商品</button>
                <button id="batch-upload-btn" class="btn-secondary">批量上传价格库存</button>
            </div>
            
            <div class="manager-grid" id="manager-grid">
                <div class="loading">加载中...</div>
            </div>
        </div>

        <!-- 用户管理页面 -->
        <div id="users-page" class="content-page" style="display: none;">
            <!-- 顶部导航栏 -->
            <div class="top-navbar">
                <button id="users-sidebar-toggle" class="sidebar-toggle" onclick="app.toggleSidebar()">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <div class="navbar-title">
                    <h1>👥 用户管理</h1>
                </div>
                <div class="navbar-user">
                    <button class="back-to-shop-btn" onclick="app.showContentPage('shop')" title="返回商店">
                        🏪
                    </button>
                    <span onclick="app.toggleSidebar()">👤</span>
                </div>
            </div>
            
            <div class="page-header">
                <p>管理系统用户和权限</p>
            </div>
            
            <div class="users-grid" id="users-grid">
                <div class="loading">加载中...</div>
            </div>
        </div>

        <!-- 个人设置页面 -->
        <div id="profile-page" class="content-page" style="display: none;">
            <!-- 顶部导航栏 -->
            <div class="top-navbar">
                <button class="sidebar-toggle" onclick="app.toggleSidebar()">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <div class="navbar-title">
                    <h1>👤 个人设置</h1>
                </div>
                <div class="navbar-user">
                    <button class="back-to-shop-btn" onclick="app.showContentPage('shop')" title="返回商店">
                        🏪
                    </button>
                    <span onclick="app.toggleSidebar()">👤</span>
                </div>
            </div>
            
            <div class="page-header">
                <p>管理您的个人信息</p>
                <div class="navigation-help">
                    💡 提示：点击右上角 🏪 返回商店，或按 ESC 键关闭菜单
                </div>
            </div>
            
            <div class="profile-container">
                <div class="profile-card">
                    <div class="profile-avatar-section">
                        <div class="avatar-display">
                            <span id="profile-avatar">👤</span>
                        </div>
                        <button id="change-avatar-btn" class="btn-link">更换头像</button>
                    </div>
                    
                    <form id="profile-form" class="profile-form">
                        <div class="form-group">
                            <label>用户名</label>
                            <input type="text" id="profile-username" placeholder="请输入用户名">
                        </div>
                        
                        <div class="form-group">
                            <label>邮箱地址</label>
                            <input type="email" id="profile-email" placeholder="请输入邮箱地址">
                        </div>
                        
                        <div class="form-group">
                            <label>用户角色</label>
                            <input type="text" id="profile-role" readonly>
                        </div>
                        
                        <button type="submit" class="btn-primary">保存设置</button>
                    </form>
                    
                    <!-- 升级为店长区域 -->
                    <div class="upgrade-section" id="upgrade-section">
                        <h3>升级为店长</h3>
                        <p>如果您有店长密码，可以升级您的账户为店长权限</p>
                        <form id="upgrade-form" class="upgrade-form">
                            <div class="form-group">
                                <label>店长密码</label>
                                <input type="password" id="manager-password" placeholder="请输入店长密码">
                                <div class="error-message" id="manager-password-error"></div>
                            </div>
                            
                            <button type="submit" class="btn-primary" id="upgrade-btn">
                                <span class="btn-text" id="upgrade-btn-text">升级为店长</span>
                                <div class="loading-spinner" style="display: none;"></div>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 购买确认页面 -->
        <div id="purchase-page" class="content-page" style="display: none;">
            <!-- 顶部导航栏 -->
            <div class="top-navbar">
                <button class="sidebar-toggle" onclick="app.showContentPage('shop')">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <div class="navbar-title">
                    <h1>🛒 购买确认</h1>
                </div>
                <div class="navbar-user">
                    <button class="back-to-shop-btn" onclick="app.showContentPage('shop')" title="返回商店">
                        🏪
                    </button>
                    <span onclick="app.toggleSidebar()">👤</span>
                </div>
            </div>
            
            <div class="purchase-container">
                <div class="purchase-success">
                    <div class="success-icon">✅</div>
                    <h2>预定成功！</h2>
                    <p>您已成功预定商品，请付钱完成购买</p>
                    
                    <div class="purchased-product" id="purchased-product">
                        <!-- 购买的商品信息将在这里显示 -->
                    </div>
                    
                    <div class="purchase-actions">
                        <button class="btn-primary" id="pay-now-btn">线下付款</button>
                        <button class="btn-secondary" onclick="app.showContentPage('shop')">返回商店</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 商品编辑/添加弹窗 -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">编辑商品</h3>
                <button id="close-modal" class="close-btn">×</button>
            </div>
            <form id="product-form">
                <div class="form-group">
                    <label>商品名称</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label>商品描述</label>
                    <textarea id="product-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>价格 (¥)</label>
                    <input type="number" id="product-price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>图片 (Emoji)</label>
                    <div class="emoji-picker-container">
                        <input type="text" id="product-image" placeholder="🍋" readonly>
                        <button type="button" id="emoji-picker-toggle" class="emoji-picker-btn">选择表情包</button>
                        
                        <div id="emoji-picker" class="emoji-picker" style="display: none;">
                            <div class="emoji-categories">
                                <button type="button" class="emoji-category-btn active" data-category="水果类">🍋 水果</button>
                                <button type="button" class="emoji-category-btn" data-category="蔬菜类">🥕 蔬菜</button>
                                <button type="button" class="emoji-category-btn" data-category="饮品类">🥛 饮品</button>
                                <button type="button" class="emoji-category-btn" data-category="主食类">🍞 主食</button>
                                <button type="button" class="emoji-category-btn" data-category="甜品类">🍰 甜品</button>
                                <button type="button" class="emoji-category-btn" data-category="快餐类">🍔 快餐</button>
                                <button type="button" class="emoji-category-btn" data-category="特色食材">🍯 食材</button>
                            </div>
                            <div id="emoji-grid" class="emoji-grid">
                                <!-- 表情包网格将通过 JavaScript 动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>分类</label>
                    <select id="product-category" required>
                        <option value="">选择分类</option>
                        <option value="柠檬饮料">柠檬饮料</option>
                        <option value="果汁">果汁</option>
                        <option value="牛奶">牛奶</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>库存</label>
                    <input type="number" id="product-stock" min="0">
                </div>
                
                <!-- 定制选项设置 -->
                <div class="form-group customization-settings">
                    <label class="section-label">🧋 定制选项设置</label>
                    <div class="customization-options">
                        <div class="option-item">
                            <input type="checkbox" id="product-has-sweetness">
                            <label for="product-has-sweetness">
                                <span class="option-icon">🍯</span>
                                <span class="option-text">支持甜度选择</span>
                            </label>
                        </div>
                        <div class="option-item">
                            <input type="checkbox" id="product-has-ice-level">
                            <label for="product-has-ice-level">
                                <span class="option-icon">🧊</span>
                                <span class="option-text">支持冰度选择</span>
                            </label>
                        </div>
                    </div>
                    <p class="customization-hint">💡 勾选后，顾客购买时可以选择相应的定制选项</p>
                </div>
                
                <div class="modal-actions">
                    <button type="button" id="cancel-btn" class="btn-secondary">取消</button>
                    <button type="submit" class="btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 头像选择弹窗 -->
    <div id="avatar-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>选择头像</h3>
                <button id="close-avatar-modal" class="close-btn">×</button>
            </div>
            <div class="avatar-grid">
                <div class="avatar-option" data-avatar="👤">👤</div>
                <div class="avatar-option" data-avatar="👨">👨</div>
                <div class="avatar-option" data-avatar="👩">👩</div>
                <div class="avatar-option" data-avatar="🧑">🧑</div>
                <div class="avatar-option" data-avatar="👨‍💼">👨‍💼</div>
                <div class="avatar-option" data-avatar="👩‍💼">👩‍💼</div>
                <div class="avatar-option" data-avatar="👨‍🍳">👨‍🍳</div>
                <div class="avatar-option" data-avatar="👩‍🍳">👩‍🍳</div>
                <div class="avatar-option" data-avatar="🤵">🤵</div>
                <div class="avatar-option" data-avatar="👸">👸</div>
                <div class="avatar-option" data-avatar="🦸">🦸</div>
                <div class="avatar-option" data-avatar="🧙">🧙</div>
            </div>
        </div>
    </div>

    <!-- 定制选择弹窗 -->
    <div id="customization-modal" class="modal">
        <div class="modal-content customization-modal-content">
            <div class="modal-header">
                <h3 id="customization-modal-title">🧋 个性化定制</h3>
                <button id="close-customization-modal" class="close-btn">×</button>
            </div>
            
            <div class="customization-product-info" id="customization-product-info">
                <!-- 商品信息将在这里显示 -->
            </div>
            
            <div class="customization-options-container">
                <!-- 甜度选择 -->
                <div class="customization-section" id="sweetness-section" style="display: none;">
                    <h4>🍯 选择甜度</h4>
                    <div class="sweetness-options">
                        <div class="sweetness-option" data-sweetness="0">
                            <input type="radio" name="sweetness" value="0" id="sweetness-0">
                            <label for="sweetness-0">0糖</label>
                        </div>
                        <div class="sweetness-option" data-sweetness="3">
                            <input type="radio" name="sweetness" value="3" id="sweetness-3" checked>
                            <label for="sweetness-3">3分糖</label>
                        </div>
                        <div class="sweetness-option" data-sweetness="5">
                            <input type="radio" name="sweetness" value="5" id="sweetness-5">
                            <label for="sweetness-5">5分糖</label>
                        </div>
                        <div class="sweetness-option" data-sweetness="7">
                            <input type="radio" name="sweetness" value="7" id="sweetness-7">
                            <label for="sweetness-7">7分糖</label>
                        </div>
                        <div class="sweetness-option" data-sweetness="10">
                            <input type="radio" name="sweetness" value="10" id="sweetness-10">
                            <label for="sweetness-10">全糖</label>
                        </div>
                    </div>
                </div>
                
                <!-- 冰度选择 -->
                <div class="customization-section" id="ice-section" style="display: none;">
                    <h4>🧊 选择冰度</h4>
                    <div class="ice-options">
                        <div class="ice-option" data-ice="none">
                            <input type="radio" name="ice-level" value="none" id="ice-none">
                            <label for="ice-none">无冰</label>
                        </div>
                        <div class="ice-option" data-ice="less">
                            <input type="radio" name="ice-level" value="less" id="ice-less">
                            <label for="ice-less">少冰</label>
                        </div>
                        <div class="ice-option" data-ice="normal">
                            <input type="radio" name="ice-level" value="normal" id="ice-normal" checked>
                            <label for="ice-normal">正常冰</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" id="customization-cancel-btn" class="btn-secondary">取消</button>
                <button type="button" id="customization-confirm-btn" class="btn-primary">确认购买</button>
            </div>
        </div>
    </div>

    <!-- 批量编辑商品弹窗 -->
    <div id="batch-edit-modal" class="modal">
        <div class="modal-content batch-edit-modal-content">
            <div class="modal-header">
                <h3>📦 批量编辑商品价格和库存</h3>
                <button id="close-batch-edit-modal" class="close-btn">×</button>
            </div>
            <div class="batch-edit-container" id="batch-edit-container">
                <div class="batch-edit-help">
                    <p>💡 可以直接在表格中编辑价格和库存，然后点击"批量上传"</p>
                </div>
                <div class="batch-edit-table-container">
                    <table class="batch-edit-table" id="batch-edit-table">
                        <thead>
                            <tr>
                                <th>商品</th>
                                <th>分类</th>
                                <th>当前价格</th>
                                <th>新价格</th>
                                <th>当前库存</th>
                                <th>新库存</th>
                            </tr>
                        </thead>
                        <tbody id="batch-edit-tbody">
                            <tr>
                                <td colspan="6" class="loading">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-actions">
                <button id="batch-upload-confirm-btn" class="btn-primary">批量上传到API</button>
                <button id="cancel-batch-edit-btn" class="btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 订单通知弹窗 -->
    <div id="orders-modal" class="modal">
        <div class="modal-content orders-modal-content">
            <div class="modal-header">
                <h3>📦 新订单通知</h3>
                <button id="close-orders-modal" class="close-btn">×</button>
            </div>
            <div class="orders-container" id="orders-container">
                <div class="loading">加载中...</div>
            </div>
            <div class="modal-actions">
                <button id="mark-all-read-btn" class="btn-secondary">全部标记为已读</button>
                <button id="close-orders-btn" class="btn-primary">关闭</button>
            </div>
        </div>
    </div>

    <!-- 全局提示消息 -->
    <div id="toast" class="toast"></div>

    <script src="script.js"></script>
</body>
</html>